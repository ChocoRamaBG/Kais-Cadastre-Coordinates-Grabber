steps:
  - name: Checkout Code
    uses: actions/checkout@v4

  - name: Setup Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.10'

  - name: Install Chrome & Dependencies
    run: |
      sudo apt-get update
      sudo apt-get install -y google-chrome-stable
      pip install pandas openpyxl selenium webdriver-manager xlsxwriter

  - name: Run Scraper (The Grind)
    id: run_script
    run: |
      # We capture the exit code to decide if we need to restart
      python main_scraper.py
    continue-on-error: true # Don't mark build as red if script exits with 1 (Time limit)

  - name: Commit Progress
    uses: stefanzweifel/git-auto-commit-action@v5
    with:
      commit_message: "ðŸ¤– Update Coordinates: Partial Progress Save"
      file_pattern: 'Gathered_Sofia_Coords.xlsx'

  - name: Check Status
    run: |
      echo "Script outcome: ${{ steps.run_script.outcome }}"

  - name: Trigger Next Run (Infinite Loop Logic)
    if: steps.run_script.outcome == 'failure' # 'failure' here means exit code was 1 (Time limit hit)
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    run: |
      echo "ðŸ”„ Time limit hit or restart requested. Triggering next run..."
      gh workflow run scrape.yml
